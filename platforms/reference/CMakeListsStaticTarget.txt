foreach(file ${SOURCE_FILES})
    if (file MATCHES ".*Vec8.*")
        if (MSVC)
            set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} /arch:AVX /D__AVX__")
        elseif (PNACL)
            set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS}")
        else (MSVC)
            set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -msse4.1 -mavx")
        endif (MSVC)
    else (file MATCHES ".*Vec8.*")
        if (NOT (MSVC or ANDROID or PNACL))
            set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -msse4.1")
        endif (NOT (MSVC or ANDROID or PNACL))
    endif (file MATCHES ".*Vec8.*")
endforeach(file)
add_library(${STATIC_TARGET} STATIC ${SOURCE_FILES} ${SOURCE_INCLUDE_FILES} ${API_ABS_INCLUDE_FILES})

target_link_libraries(${STATIC_TARGET} ${quickstep_LIBRARY_NAME}_static ${PTHREADS_LIB_STATIC})
#-DPTW32_STATIC_LIB only works for the windows pthreads.
set_target_properties(${STATIC_TARGET} PROPERTIES LINK_FLAGS "${EXTRA_COMPILE_FLAGS}" COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -Dquickstep_CPU_BUILDING_STATIC_LIBRARY -DPTW32_STATIC_LIB")

INSTALL_TARGETS(/lib/plugins RUNTIME_DIRECTORY /lib/plugins ${STATIC_TARGET})