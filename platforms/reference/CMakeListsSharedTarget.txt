foreach(file ${SOURCE_FILES})
    if (file MATCHES ".*Vec8.*")
        if (MSVC)
            set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} /arch:AVX /D__AVX__")
        else (MSVC)
            if (NOT ANDROID)
                set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -msse4.1 -mavx")
            endif (NOT ANDROID)
        endif (MSVC)
    else (file MATCHES ".*Vec8.*")
        if (NOT MSVC)
            if (NOT ANDROID)
                set_source_files_properties(${file} PROPERTIES COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -msse4.1")
            endif (NOT ANDROID)
        endif (NOT MSVC)
    endif (file MATCHES ".*Vec8.*")
endforeach(file)
add_library(${SHARED_TARGET} SHARED ${SOURCE_FILES} ${SOURCE_INCLUDE_FILES} ${API_ABS_INCLUDE_FILES})

target_link_libraries(${SHARED_TARGET} ${quickstep_LIBRARY_NAME} ${PTHREADS_LIB})
set_target_properties(${SHARED_TARGET} PROPERTIES LINK_FLAGS "${EXTRA_COMPILE_FLAGS}" COMPILE_FLAGS "${EXTRA_COMPILE_FLAGS} -Dquickstep_CPU_BUILDING_SHARED_LIBRARY")

install_targets(/lib/plugins RUNTIME_DIRECTORY /lib/plugins ${SHARED_TARGET})
